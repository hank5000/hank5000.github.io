<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[The Coding Life]]></title>
  <link href="http://hank5000.github.io/atom.xml" rel="self"/>
  <link href="http://hank5000.github.io/"/>
  <updated>2015-06-24T18:47:41+08:00</updated>
  <id>http://hank5000.github.io/</id>
  <author>
    <name><![CDATA[Hank Wu]]></name>
    <email><![CDATA[hankwuwu@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Live555 RTSP Server on Android]]></title>
    <link href="http://hank5000.github.io/blog/2015/06/24/live555-rtsp-server-on-android/"/>
    <updated>2015-06-24T13:20:58+08:00</updated>
    <id>http://hank5000.github.io/blog/2015/06/24/live555-rtsp-server-on-android</id>
    <content type="html"><![CDATA[<p>最近在看 RTSP Server on Android 相關資源，趁現在有空就把它整理整理。</p>

<ol>
<li><p>RTSP Server最有名的大概就是 <a href="http://www.live555.com/"><strong>Live555</strong></a>，這套功能還不錯可以支援 .264, .265, .aac, .amr, &hellip; 比較重要的是它可以支援 .mkv, .ts (如果Stream這兩種格式都會把Video 跟Audio一同Stream出去, .mkv還會有Subtitle)，還有很多格式建議到官網去看一下。</p></li>
<li><p>我找到的另外一個是已經在Android上實現RTSP Server功能的一個Library，叫做<a href="https://github.com/fyhertz/libstreaming"><strong>libstreaming</strong></a>，
作者叫做fyhertz，他還有另外一個作品叫做<a href="https://play.google.com/store/apps/details?id=net.majorkernelpanic.spydroid&amp;amp;hl=zh_TW">spydroid-ipcam</a>，
其功能是把Android手機的Camera跟Microphone透過RTP/UDP發送出去，而libstreaming就是他這套Application的核心library。</p></li>
</ol>


<p>(在作者的github網頁中可以找到spydroid-ipcam的source code 跟libstreaming library 還有libstreaming的example1/2/3, 使用者可以使用libstreaming library + libstreaming example1 拼成spydroid-ipcam簡易的樣子)</p>

<hr />

<p>找好資源後就要自己動工了，如果要讓RTSP Server跑在Android上面並且支援Stream local file的話大概就是兩個選項，在下面一併附上我實作的方法。</p>

<ol>
<li><h2>移植Live555到Android上面</h2>

<ul>
<li><p>Live555 Download後解開把source code直接把live下的所有文件放到你想要使用的project下的jni目錄中(需要把project的native support打開並且指定好ndk path)</p>

<pre><code>Live555project/jni# tree -d
.
├──BasicUsageEnvironment
│   └── include
├── groupsock
│   └── include
├── liveMedia
│   └── include
├── mediaServer
├── proxyServer
├── testProgs
├── UsageEnvironment
│   └── include
└── WindowsAudioInputDevice
</code></pre></li>
</ul>


<p> 檔案太多就不都列出來拉，總之jni下面就是解開live555中live資料夾裡面的東西。</p>

<ul>
<li><p>然後要補上Android.mk 跟 一個銜接java 跟 native層的一個.cpp file.</p>

<ul>
<li>Live555的Android.mk在網路上可以找到，<a href="http://blog.csdn.net/sunwutian0325/article/details/8582524">連結在此</a>，但是由於他這個版本是2013年的版本，所以使用者使用時必須再加上一些檔案以及mediaServer的部分到LOCAL_SRC_FILE下，再把LOCAL_MODULE的名稱改成 live555， Android.mk一樣是放在jni下。</li>
<li>.cpp大概的寫法就是把live555mediaserver.cpp的main function copy把header file寫一寫，然後這隻function name要符合jni的規範讓java層Call的到(ex:Java_com_example_rtspserver_MainActivity_RunRTSPServer&hellip;)
然後開始build application，如果你設定都沒有錯應該就會把liblive555.so build出來並且放到project/libs/armeabi/ 下，並且放到.apk中</li>
</ul>
</li>
</ul>
</li>
<li><h2>改libStreaming使之支援Streaming Local file</h2>

<ul>
<li><p>我改到可以把local file解開然後把其.264部分傳出來，但是這就比較複雜，就不多寫了，主要就是要把URLEncodedUtil那邊看的東西多加local file資訊，這樣Server才會知道Client想要看哪個video，然後要demux該影片，demux這工作可以不用自己來，可以使用ffmpeg或者是Android自帶的api MediaExtractor(Android4.3開始提供)，這邊提供如何取出Video的方法:</p>

<pre><code>MediaExtractor mExtractor = new MediaExtractor();
ByteBuffer mTransBuffer = ByteBuffer.allocate(102410242);
private byte[] mTmpBuf = new byte[102410242];
String path = “video_path/abc.mp4”;
mExtractor.setDataSource(path);
int numTrack = mExtractor.getTrackCount();
int h264Track = -1;
for(int i=0;i&lt;numTrack;++i)
{
    MediaFormat format = mExtractor.getTrackFormat(i);
    String mime = format.getString(MediaFormat.KEY_MIME);
    if(mime.contains(“video”) &amp;&amp; mime.contains(“avc”))
    {
        h264Track = i;
    }
}
if(h264Track!=-1)
{
    mExtractor.selectTrack(h264Track);
    while(true)
    {
        int Size = mExtractor.readSampleData(mTransBuffer,0); // read frame to mTransBuffer
        mTransBuffer.get(mTmpBuf);
        mExtractor.advance(); // go next frame
    }
}
</code></pre></li>
</ul>
</li>
</ol>


<p>以上就是使用android原生的api去demux一個video file,</p>

<p>使用前提是該container format為android support的format，</p>

<p>在readSampleData後把拿到的mTransBuffer裝到mTmpBuf再把mTmpBuf改裝到在H264Packetizer.cpp中的function Send()，</p>

<p>其Send()原本是把Encode好的BitStream取出然後包裝送出，現在就把他替換成我們Demux之後的video source就可以了.</p>

<p>不過用libstreaming library好像有一些問題在，例如Streaming high bitrate的264會有很容易破圖,可能是有更多的細節需要做更改。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to use Octopress]]></title>
    <link href="http://hank5000.github.io/blog/2015/06/16/how-to-use-octopress/"/>
    <updated>2015-06-16T23:30:00+08:00</updated>
    <id>http://hank5000.github.io/blog/2015/06/16/how-to-use-octopress</id>
    <content type="html"><![CDATA[<h1>Something about Octopress</h1>

<hr />

<h2>紀錄如何使用github + octopress架個人網站，順便讓自己熟悉一下Markdown語法。</h2>

<ul>
<li>如果是第一次聽到git的人可能要先去熟悉一下git的操作方法，可以到<a href="https://www.codeschool.com/paths/git">CodeSchool</a>學一下基本的操作方法。</li>
<li>octopress的介紹可以看看<a href="http://blog.xdite.net/posts/2011/10/07/what-is-octopress/">高手的介紹</a></li>
<li>關於markdown的好處跟介紹可以參考<a href="http://markdown.tw/" title="markdown.tw">此連結</a></li>
<li>環境似乎是在 Mac or Ubuntu 會相對比 Windows方便</li>
</ul>


<hr />

<h2>Outline :</h2>

<h3>1. <a href="#Create%20github">創建github repository</a></h3>

<h3>2. <a href="#Built%20Octopress">架設Octopress環境</a></h3>

<h3>3. <a href="#post%20delete">使用Octopress 發文/刪文</a></h3>

<h3>4. <a href="#Octopress%20theme">更換Octopress theme</a></h3>

<h3>5. <a href="#Clone%20env">如何在別台電腦上clone你做好的octopress環境</a></h3>

<h3>6. <a href="#About%20Markdown">編寫Markdown好用軟體</a></h3>

<hr />

<h2><a name="Create github">1.</a> 創建github repository (前提是你已經有github帳號，如果沒有就去<a href="https://github.com/">註冊</a>)</h2>

<p>這邊介紹我使用的方法，登入github之後選擇 + New repository，並且在Repository name的地方填上 <em>username.github.io</em>，之後你就會生出一個叫做username.github.io的Repository，這個就是以後作為你的github page使用。</p>

<h2><a name="Built Octopress">2.</a> 架設Octopress環境</h2>

<p>如何架設Ocotpress環境可以參考<a href="http://octopress.org/docs/setup/">官方網站</a>
大概就是</p>

<ul>
<li>安裝 git</li>
<li>安裝 ruby 1.9.3 ，較建議使用 rvm 安裝</li>
<li>最後一個 Install one of the ExecJS supported JavaScript runtimes. (我沒安裝)</li>
</ul>


<p>當這些環境都弄好之後，當然就是要把octopress 從git clone下來囉</p>

<pre><code>$ git clone https://github.com/imathis/octopress
$ cd octopress
$ rake install
$ rake setup_github_pages
</code></pre>

<p>在這之後他會要求你的github repository, 你可以進到你的github repository右邊有個 SSH clone URL 裡面框框的內容直接複製貼上就可以，如果你第一步跟我是一樣的話，你的這串字應該是 <em>git@github.com:username/username.github.io.git</em>，然後再輸入指令如下：</p>

<pre><code>$ rake generate
$ rake deploy
</code></pre>

<p>他就會把目前你的這些東西都推到你的github page上了，這時你可以連到你的github page看看囉(如果沒有生效可能要等一下下)</p>

<p>然後你要把目前目錄下的所有東西push到git上面做個備份</p>

<pre><code>$ git add .
$ git commit -m "github first commit"
$ git push origin source
</code></pre>

<p>此時你的github repo會有兩個branch一個是source 一個是master，source是你目前這個octopress資料夾下的所有檔案除了_deploy，而master呢就是你實際的網頁內容(_deploy資料夾裡面的部分)</p>

<h2><a name="post delete">3.</a> 使用Octopress發文/刪文</h2>

<h3>發文</h3>

<pre><code>$ rake new_post['文章標題']
</code></pre>

<p>Octopress會生成個 *.markdown 到你的./source/_posts/ 下面，就我理解這個有點像是原始檔(Markdown Source Code)，然後你可以在 *.markdown中用markdown語法寫文章存檔，然後執行</p>

<pre><code>$ rake generate
</code></pre>

<p>他會去編譯 *.markdown變成 *.html 放到 _deploy的某個目錄中，然後再執行</p>

<pre><code>$ rake deploy
</code></pre>

<p>他會把_deploy新增的或者是刪除的push到github做修改，在po好文章之後你只有把html的部份上傳，可是*.markdown的部分並未上傳做備份，記得再輸入</p>

<pre><code>$ git add .
</code></pre>

<p>or</p>

<pre><code>$ git add "新的file path"
</code></pre>

<p>then</p>

<pre><code>$ git commit -m "一些敘述"
$ git push
</code></pre>

<ul>
<li><h3>刪文</h3></li>
</ul>


<p>有了剛剛些概念後應該可以大概知道，使用</p>

<pre><code>$ rake new_post["post_name"]
</code></pre>

<p>他其實是幫你把 *.markdown生成到source/_posts/&hellip;，然後再透過</p>

<pre><code>$ rake generate
</code></pre>

<p>去把html檔生成出來，也就是說如果要刪文的話，你可以到source/_posts/&hellip;，去找你想要刪掉的文章</p>

<pre><code>$ rm source/_posts/XXXXXX.markdown
</code></pre>

<p>然後在執行</p>

<pre><code>$ rake generate
$ rake deploy
</code></pre>

<p>這樣他就會去把在github上面的相關 html給刪除</p>

<p>或者是你可以直接在*.markdown上面有一串字描述這篇文章的屬性的</p>

<pre><code>---
layout: post
title: "How to use Octopress"
date: 2015-06-16 23:30
comments: true
external-url:
categories: octopress
published: true
---
</code></pre>

<p>加入pulished屬性，然後把它改成false。</p>

<h2><a name="Octopress theme">4.</a> 更換Octopress theme</h2>

<p>來來來來看<a href="http://tommy351.github.io/Octopress-Theme-Slash/index_tw.html">這篇</a>你大概就知道怎麼更換Octopress theme囉，連結裡面那篇是一個叫做Slash的主題，非常的簡約風格，就是我現在使用的這個，照著他教學做，你也可以跟我的風格一樣囉</p>

<h2><a name="Clone env">5.</a> 如何在別台電腦上clone你做好的octopress環境</h2>

<p>這件事是困擾我最久的，也是我搞最久的，剛好有找到一個很好的教學，前提你架設過octopress然後在github也有紀錄，你是想在另外一條電腦上發文章，你該怎麼複製出一份一樣的環境呢（octopress最基本的ruby跟git是一定要有的）</p>

<pre><code>$ git clone -b source git@github.com:username/username.github.com.git octopress
$ cd octopress
$ git clone git@github.com:username/username.github.com.git _deploy 
$ gem install bundler
$ bundler install
</code></pre>

<p>不用再執行</p>

<pre><code>$ rake setup_github_pages
</code></pre>

<p>直接可以使用囉。</p>

<h2><a name="About Markdown">6.</a> 編寫Markdown好用軟體</h2>

<ul>
<li><h3>Miu</h3>

<p>這套僅僅在OSX才有。</p></li>
<li><h3>Mou</h3>

<p>這套是別人品持著Miu的概念，在Windows下開發的Markdown editor。</p></li>
<li><h3>GitBook editor</h3>

<p>這套聽起來就很Git,他是專門拿來寫書用的, 不過應該也可以拿來寫單一頁Markdown文章。</p></li>
</ul>


<h2>小筆記</h2>

<p>在文字前面加上</p>

<pre><code>&lt;a name="something"&gt; 
</code></pre>

<p>後面加上</p>

<pre><code>&lt;/a&gt; 
</code></pre>

<p>可以在文章上面產生一個Internal link, 在想要link到這段的文章給上連結 #something 就可以了，不過在這太放太近了可能感覺不出來，Outline的連結也是這樣做的，可以試試看.</p>

<p>例如：</p>

<p>Go To <a href="#case1">Case1</a></p>

<p>Go To <a href="#case2">Case2</a></p>

<p><a name="case1">Case1</a>:
this is case1</p>

<p><a name="case2">Case2</a>:
This is case2</p>

<p>其原始碼為：</p>

<pre><code>Go To [Case1](#case1)

Go To [Case2](#case2)


&lt;a name="case1"&gt;Case1&lt;/a&gt;:
this is case1

&lt;a name="case2"&gt;Case2&lt;/a&gt;:
This is case2
</code></pre>

<hr />

<h3>參考來源：</h3>

<ul>
<li><h4><a href="http://blog.xdite.net/posts/2011/10/07/what-is-octopress/">Why Octopress?</a></h4></li>
<li><h4><a href="http://octopress.org/">Octopress 官網</a></h4></li>
<li><h4><a href="http://wen00072-blog.logdown.com/posts/258497-octopress-installed-and-deployed-on-the-github-pages#oct-dl">國王的耳朵是驢耳朵</a></h4></li>
<li><h4><a href="http://cn.soulmachine.me/blog/20140128/">Restore Octopress at a New Computer</a></h4></li>
</ul>

]]></content>
  </entry>
  
</feed>
